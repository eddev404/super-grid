<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title class="italicTitle">Super Grid+</title>
    <style>
        :root {
            --cell-size: calc(5000px / 50);
        }

        body {
            font-family: sans-serif;
            background-color: #1e1e1e;
            color: white;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: row;
            height: 100vh;
            overflow: hidden;
            gap: 5px;
        }

        body.fullscreen {
            overflow: hidden;
            gap: 0;
        }

        .side-panel {
            width: 20vw;
            min-width: 250px;
            max-width: 350px;
            background-color: #111;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1vh 0.5vw;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
            overflow-x: hidden;
            max-height: 100vh;
            transition: transform 0.3s ease;
        }

        .italicTitle {
            font-style: italic;
        }

        body.fullscreen .side-panel {
            display: none;
        }

        .draggable-token {
            transform-origin: left;
        }

        .floating-panel {
            display: none;
            position: fixed;
            top: 10px;
            left: 10px;
            width: 300px;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 150;
            background: rgba(51, 51, 51, 0.7);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        body.fullscreen .floating-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
        }


        .floating-panel.dragging {
            opacity: 0.9;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
        }

        .floating-panel.collapsed .panel-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .floating-panel .panel-content {
            max-height: none;
            transition: max-height 0.3s ease-out;
        }

        .panel-collapsible {
            background: rgba(51, 51, 51, 0.7);
            color: white;
            cursor: pointer;
            padding: 10px;
            width: 100%;
            border: none;
            text-align: left;
            font-size: 16px;
            border-radius: 6px;
            transition: background 0.3s ease;
            margin-bottom: 10px;
        }

        body.fullscreen .panel-collapsible {
            cursor: move;
        }

        .panel-collapsible:hover {
            background: rgba(81, 81, 81, 0.7);
        }

        .panel-collapsible::after {
            float: right;
            content: "\25BE";
            transition: transform 0.3s;
        }

        .panel-collapsible.collapsed::after {
            transform: rotate(180deg);
        }

        .top-bar {
            width: 100%;
            background: #222;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            border-radius: 8px;
            margin-bottom: 1vh;
        }

        .top-bar select,
        audio {
            width: 90%;
        }

        .token-list {
            display: flex;
            gap: 1px;
            flex-wrap: wrap;
            background: #333;
            padding: 10px;
            border-radius: 8px;
            justify-content: center;
            margin-bottom: 1vh;
        }

        .floating-panel .token-list {
            background: transparent;
        }

        .token {
            width: 50px;
            height: 50px;
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 5px;
            box-sizing: border-box;
        }

        .token:hover {
            border-color: #fff;
            filter: brightness(1.2);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .selected {
            border: 2px solid rgb(255, 0, 0) !important;
        }

        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            overflow: hidden;
            padding: 0;
            margin: 0;
            transition: all 0.3s ease;
        }

        body.fullscreen main {
            width: 100vw;
            height: 100vh;
            margin: 0;
        }

        .board {
            position: relative;
            width: 5000px;
            height: 5000px;
        }

        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            transform-origin: top left;
            transition: transform 0.2s ease;
        }

        .draggable-token {
            position: absolute;
            cursor: pointer;
            z-index: 10;
            box-sizing: border-box;
            border: 1px solid rgba(31, 133, 8, 0.7);
            border-radius: 4px;
            box-shadow: 0 0 8px rgba(31, 133, 8, 0.7);
            transform-origin: top left;
            transition: transform 0.2s ease;
        }

        .draggable-token:hover {
            border: 2.5px solid #d4a017;
            filter: brightness(1.3);
            box-shadow: 0 0 15px rgba(212, 160, 23, 0.9);
        }

        .buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        .button-row-top,
        .button-row-bottom {
            display: flex;
            gap: 8px;
            justify-content: center;
            width: 100%;
        }

        .button-row-top button,
        .button-row-bottom button,
        .upload-btn,
        .load-btn,
        #toggleFullscreen,
        #toggleFullscreenFloating,
        #saveBoard,
        #saveBoardFloating,
        #loadBoard,
        #loadBoardFloating {
            background-color: #444;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            height: 36px;
            box-sizing: border-box;
            width: 90px;
            text-align: center;
            transition: background-color 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.fullscreen .button-row-top button,
        body.fullscreen .button-row-bottom button,
        body.fullscreen .upload-btn,
        body.fullscreen .load-btn,
        body.fullscreen #toggleFullscreenFloating,
        body.fullscreen #saveBoardFloating,
        body.fullscreen #loadBoardFloating {
            background: rgba(51, 51, 51, 0.7);
        }

        .upload-btn:hover {
            background-color: #28a745;
            box-shadow: 0 0 10px #28a745;
        }

        #resetBoard:hover,
        #resetBoardFloating:hover {
            background-color: #cc0000;
            box-shadow: 0 0 10px #ff0000;
        }

        #toggleFullscreen:hover,
        #toggleFullscreenFloating:hover {
            background-color: #007bff;
            box-shadow: 0 0 10px #007bff;
        }

        #saveBoard:hover,
        #saveBoardFloating:hover {
            background-color: #d4a017;
            box-shadow: 0 0 10px #d4a017;
        }

        #loadBoard:hover,
        #loadBoardFloating:hover {
            background-color: #ff02eae6;
            box-shadow: 0 0 10px #ff02eae6;
        }

        body.fullscreen .upload-btn:hover {
            background-color: rgba(40, 167, 69, 0.9);
            box-shadow: 0 0 10px #28a745;
        }

        body.fullscreen #resetBoardFloating:hover {
            background-color: rgba(204, 0, 0, 0.9);
            box-shadow: 0 0 10px #ff0000;
        }

        body.fullscreen #toggleFullscreenFloating:hover {
            background-color: rgba(0, 123, 255, 0.9);
            box-shadow: 0 0 10px #007bff;
        }

        body.fullscreen #saveBoardFloating:hover {
            background-color: rgba(212, 160, 23, 0.9);
            box-shadow: 0 0 10px #d4a017;
        }

        body.fullscreen #loadBoardFloating:hover {
            background-color: #ff02eae6;
            box-shadow: 0 0 10px #ff02eae6;
        }

        .notes-panel {
            width: 250px;
            padding: 10px;
            background-color: #111;
            display: flex;
            flex-direction: column;
            gap: 10px;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.5);
            align-items: center;
            transition: transform 0.3s ease;
        }

        body.fullscreen .notes-panel {
            display: none;
        }

        .notes-panel h3 {
            margin: 0;
            text-align: center;
        }

        .notes-panel select {
            width: 100%;
            padding: 8px;
            background: #222;
            color: white;
            border: 1px solid #333;
            border-radius: 4px;
        }

        .notes-panel textarea {
            flex: 1;
            resize: none;
            width: 100%;
            height: 60vh;
            background-color: #222;
            color: #fff;
            border: 1px solid #333;
            border-radius: 8px;
            font-family: monospace;
        }

        @media (max-width: 768px) {
            body {
                flex-direction: column;
                overflow: auto;
                gap: 5px;
            }

            .side-panel {
                width: 100%;
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                padding: 5px;
            }

            .floating-panel {
                width: 90vw;
                left: 5vw;
            }

            .board {
                width: 90vw;
                height: 90vw;
            }

            .notes-panel {
                width: 100%;
                padding: 5px;
            }

            .button-row-top,
            .button-row-bottom {
                flex-wrap: nowrap;
                overflow-x: auto;
            }

            .button-row-top button,
            .button-row-bottom button,
            .upload-btn,
            .load-btn {
                width: 80px;
                font-size: 12px;
                padding: 8px 6px;
            }
        }

        .upload-btn,
        .load-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #444;
            padding: 0;
        }

        .upload-btn input[type="file"],
        .load-btn input[type="file"] {
            display: none;
        }

        .collapsible-section {
            width: 100%;
            margin-bottom: 1vh;
        }

        .collapsible {
            background-color: #222;
            color: white;
            cursor: pointer;
            padding: 10px;
            width: 100%;
            border: none;
            text-align: left;
            font-size: 16px;
            border-radius: 6px;
            transition: background 0.3s ease;
        }

        .floating-panel .collapsible {
            background: rgba(51, 51, 51, 0.7);
        }

        .collapsible:hover {
            background-color: #333;
        }

        .floating-panel .collapsible:hover {
            background: rgba(81, 81, 81, 0.7);
        }

        .collapsible::after {
            float: right;
            content: "\25BE";
            transition: transform 0.3s;
        }

        .collapsible.active::after {
            transform: rotate(180deg);
        }

        .content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: #333;
            border-radius: 8px;
        }

        .floating-panel .content {
            background: transparent;
        }

        .line-line {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
            justify-content: center;
            align-items: center;
            /* Garante centralização horizontal */
            margin-bottom: 10px;
        }


        .floating-panel .line-line {
            background: transparent;
        }

        #board-container {
            width: 100%;
            height: 100%;
            max-width: 1200px;
            max-height: 1200px;
            overflow: scroll;
            position: relative;
            display: block;
            scrollbar-width: auto;
            scrollbar-color: #666 #222;
            cursor: grab;
            transition: all 0.3s ease;
            background-color: #1e1e1e;
        }

        body.fullscreen #board-container {
            max-width: 100vw;
            max-height: 100vh;
            width: 100vw;
            height: 100vh;
            margin: 0;
        }

        #board-container.grabbing {
            cursor: grabbing;
        }

        #board-container::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        #board-container::-webkit-scrollbar-track {
            background: #222;
        }

        #board-container::-webkit-scrollbar-thumb {
            background: #666;
            border-radius: 6px;
        }

        #board-container::-webkit-scrollbar-thumb:hover {
            background: #888;
        }

        .dice-roller {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 10px;
            background: #333;
            border-radius: 8px;
            width: 100%;
            box-sizing: border-box;
        }

        .floating-panel .dice-roller {
            background: transparent;
        }

        .dice-roller select,
        .dice-roller button {
            width: 100%;
            padding: 8px;
            background: #222;
            color: white;
            border: 1px solid #333;
            border-radius: 4px;
            font-size: 14px;
        }

        .dice-roller input[type="number"] {
            width: 90%;
            max-width: 150px;
            padding: 8px;
            background: #222;
            color: white;
            border: 1px solid #333;
            border-radius: 4px;
            font-size: 14px;
        }

        .dice-roller button {
            background-color: #444;
            cursor: pointer;
        }

        .dice-roller button:hover {
            background-color: #666;
        }

        .dice-roller textarea {
            width: 100%;
            height: 100px;
            background-color: #222;
            color: #fff;
            border: 1px solid #333;
            border-radius: 8px;
            font-family: monospace;
            resize: none;
            padding: 8px;
            box-sizing: border-box;
        }

        .dice-animation {
            position: absolute;
            z-index: 100;
            font-size: 48px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 5px #000, 0 0 10px #ff0;
            pointer-events: none;
            opacity: 0;
            transform: translate(-50%, -50%) scale(1);
            animation: diceRoll 3s ease-in-out forwards;
        }

        @keyframes diceRoll {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5) rotate(0deg);
            }

            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2) rotate(360deg);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1) rotate(720deg);
            }
        }

        #resetModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: #333;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            text-align: center;
            width: 300px;
            max-width: 90%;
        }

        .modal-content p {
            margin: 0 0 20px;
            font-size: 16px;
            color: #fff;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .modal-buttons button {
            background-color: #444;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s, box-shadow 0.2s;
        }

        #confirmResetYes:hover {
            background-color: #cc0000;
            box-shadow: 0 0 10px #ff0000;
        }

        #confirmResetNo:hover {
            background-color: #007bff;
            box-shadow: 0 0 10px #007bff;
        }

        /* Help Button */
        #helpButton,
        #helpButtonFloating {
            background-color: #444;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            height: 36px;
            box-sizing: border-box;
            width: 90px;
            text-align: center;
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #helpButton:hover,
        #helpButtonFloating:hover {
            background-color: rgba(0, 251, 255, 0.901);
            /* Magenta vibrante para hover? */
            box-shadow: 0 0 10px rgba(0, 251, 255, 0.901);
        }

        body.fullscreen #helpButtonFloating {
            background: rgba(51, 51, 51, 0.7);
        }

        body.fullscreen #helpButtonFloating:hover {
            background-color: rgba(0, 255, 255, 0.9);
            /* Magenta com transparência em fullscreen */
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.9);
        }

        /* Help Modal */
        #helpModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }

        #helpModal .modal-content {
            background: #333;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            text-align: left;
            width: 400px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        #helpModal h3 {
            margin: 0 0 10px;
            text-align: center;
            font-size: 18px;
            color: #fff;
        }

        #helpModal p {
            margin: 0 0 10px;
            font-size: 16px;
            color: #fff;
        }

        #helpModal ul {
            margin: 0;
            padding-left: 20px;
            color: #fff;
        }

        #helpModal li {
            margin-bottom: 8px;
            font-size: 14px;
        }

        #helpModal kbd {
            background-color: #222;
            border: 1px solid #444;
            border-radius: 3px;
            padding: 2px 4px;
            font-family: monospace;
            font-size: 12px;
        }

        #closeHelpModal {
            background-color: #444;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s, box-shadow 0.2s;
        }

        #closeHelpModal:hover {
            background-color: #ff0008;
            /* Azul consistente com o botão "Não" do resetModal */
            box-shadow: 0 0 10px #ff0008;
        }

        @media (max-width: 768px) {
            #helpModal .modal-content {
                width: 300px;
                font-size: 14px;
            }

            #helpModal h3 {
                font-size: 16px;
            }

            #helpModal li {
                font-size: 12px;
            }

            #helpButton,
            #helpButtonFloating {
                width: 80px;
                font-size: 12px;
                padding: 8px 6px;
            }
        }

        /* Título Mágico */
        .magic-title {
            font-size: 20px;
            font-weight: bold;
            background: linear-gradient(45deg, #ff00ff, #00ffff, #ff00ff);
            background-size: 200%;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: wave 3s linear infinite;
            text-shadow: 0 0 10px rgba(255, 0, 255, 0.7);
        }

        @keyframes wave {
            0% {
                background-position: 0%;
            }

            100% {
                background-position: 200%;
            }
        }

        /* Efeito de Brilho Estelar */
        .sparkle {
            position: relative;
            color: #fff;
            animation: sparkle 2s ease-in-out infinite;
            text-shadow: 0 0 5px #00ffff, 0 0 10px #ff00ff;
        }

        @keyframes sparkle {

            0%,
            100% {
                text-shadow: 0 0 5px #00ffff, 0 0 10px #ff00ff, 0 0 15px #ff00ff;
            }

            50% {
                text-shadow: 0 0 10px #00ffff, 0 0 20px #ff00ff, 0 0 30px #ff00ff;
            }
        }

        /* Efeito de Gradiente Animado */
        .glow {
            background: linear-gradient(90deg, #ff00ff, #00ff00, #00ffff, #ff00ff);
            background-size: 400%;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: glow 4s linear infinite;
            text-shadow: 0 0 8px rgba(0, 255, 255, 0.5);
        }

        @keyframes glow {
            0% {
                background-position: 0%;
            }

            100% {
                background-position: 400%;
            }
        }

        /* Efeito de Gradiente Estático com Pulsação */
        .gradient {
            background: linear-gradient(45deg, #ff1493, #00b7eb);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.8;
            }
        }

        /* Reduzir animações para acessibilidade */
        @media (prefers-reduced-motion: reduce) {

            .magic-title,
            .sparkle,
            .glow,
            .gradient {
                animation: none;
                text-shadow: none;
                color: #fff;
                background: none;
            }
        }

        /* Ajustes no modal para suportar os efeitos */
        #helpModal .modal-content {
            background: #222;
            border: 2px solid #ff00ff;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
        }

        #helpModal p,
        #helpModal li {
            color: #ddd;
        }

        #helpModal kbd {
            background: #333;
            border: 1px solid #00ffff;
            color: #00ffff;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .magic-title {
                font-size: 16px;
            }

            .sparkle,
            .glow,
            .gradient {
                font-size: 12px;
            }

            #helpModal .modal-content {
                padding: 15px;
            }
        }
    </style>
</head>

<body>
    <div class="side-panel">
        <div class="top-bar">
            <label for="musicSelect">Music:</label>
            <select id="musicSelect">
                <option value="./source/sounds/sky-theme.wav">Sky Theme</option>
                <option value="./source/sounds/gentle-guitar.wav">Gentle Guitar</option>
                <option value="./source/sounds/guitar-reflection.wav">Gentle Guitar II</option>
                <option value="./source/sounds/fantasy-forest.ogg">Fantasy Forest</option>
                <option value="./source/sounds/boss.mp3">Boss Fight</option>
                <option value="./source/sounds/elven.mp3">Elven Forest</option>
                <option value="./source/sounds/groovy.wav">Groovy Action</option>
                <option value="./source/sounds/medieval-fantasy.flac">Medieval Fantasy</option>
                <option value="./source/sounds/mirage-unaware.wav">Mirage</option>
                <option value="./source/sounds/rain-pyramides.mp3">Rain Action</option>
                <option value="./source/sounds/realm-adventure.mp3">Realm Adventure</option>
                <option value="./source/sounds/rainy-days.mp3">Rainy Days</option>
                <option value="./source/sounds/adventure-theme.wav">Adventure Theme</option>
                <option value="./source/sounds/adventure-theme-2.wav">Adventure Theme II</option>
            </select>
            <audio id="audioPlayer" controls autoplay loop>
                <source src="./source/sounds/sky-theme.wav" type="audio/mpeg">
            </audio>
        </div>
        <div class="line-line">
            <div class="button-row-top">
                <label class="upload-btn">Upload Map<input type="file" id="customMap" accept="image/*"></label>
                <button id="resetBoard">Reset</button>
                <button id="toggleFullscreen">Full Screen</button>
            </div>
            <div class="button-row-bottom">
                <button id="saveBoard">Save</button>
                <button id="helpButton">Help </button>
                <label class="load-btn" id="loadBoard">Load<input type="file" id="loadBoardInput"
                        accept="application/json"></label>
            </div>            
        </div>
        <!-- <div class="line-line">
            
        </div> -->
        <div class="collapsible-section">
            <button class="collapsible">Heroes ▾</button>
            <div class="content">
                <div class="token-list" id="characterTokens">
                    <img src="./source/hero-monster/hero-1.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-2.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-3.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-4.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-5.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-6.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-7.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-8.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-9.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-10.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-11.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-12.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-13.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-14.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-15.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-16.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-17.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-18.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-19.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-20.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-21.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-22.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-23.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-24.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-25.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-26.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-27.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-28.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-29.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-30.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-31.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-32.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-33.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-34.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-35.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-36.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-37.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-38.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-39.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-40.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-41.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-42.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-43.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-44.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-45.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-46.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-47.png" class="token" draggable="false">
                    <img src="./source/hero-monster/hero-48.png" class="token" draggable="false">
                </div>
            </div>
        </div>
        <div class="collapsible-section">
            <button class="collapsible">Portraits ▾</button>
            <div class="content">
                <div class="token-list" id="portraitTokens">
                    <img src="./source/portrait/portrait-1.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-2.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-3.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-4.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-5.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-6.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-7.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-8.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-9.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-10.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-11.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-12.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-13.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-14.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-15.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-16.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-17.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-18.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-19.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-20.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-21.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-22.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-23.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-24.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-25.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-26.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-27.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-28.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-29.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-30.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-31.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-32.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-33.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-34.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-35.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-36.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-37.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-38.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-39.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-40.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-41.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-42.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-43.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-44.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-45.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-46.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-47.png" class="token" draggable="false">
                    <img src="./source/portrait/portrait-48.png" class="token" draggable="false">
                </div>
            </div>
        </div>
        <div class="collapsible-section">
            <button class="collapsible">Modern ▾</button>
            <div class="content">
                <div class="token-list" id="modernTokens">
                    <img src="./source/modern/modern-1.png" class="token" draggable="false">
                    <img src="./source/modern/modern-2.png" class="token" draggable="false">
                    <img src="./source/modern/modern-3.png" class="token" draggable="false">
                    <img src="./source/modern/modern-4.png" class="token" draggable="false">
                    <img src="./source/modern/modern-5.png" class="token" draggable="false">
                    <img src="./source/modern/modern-6.png" class="token" draggable="false">
                    <img src="./source/modern/modern-7.png" class="token" draggable="false">
                    <img src="./source/modern/modern-8.png" class="token" draggable="false">
                    <img src="./source/modern/modern-9.png" class="token" draggable="false">
                    <img src="./source/modern/modern-10.png" class="token" draggable="false">
                    <img src="./source/modern/modern-11.png" class="token" draggable="false">
                    <img src="./source/modern/modern-12.png" class="token" draggable="false">
                    <img src="./source/modern/modern-13.png" class="token" draggable="false">
                    <img src="./source/modern/modern-14.png" class="token" draggable="false">
                    <img src="./source/modern/modern-15.png" class="token" draggable="false">
                    <img src="./source/modern/modern-16.png" class="token" draggable="false">
                    <img src="./source/modern/modern-17.png" class="token" draggable="false">
                    <img src="./source/modern/modern-18.png" class="token" draggable="false">
                    <img src="./source/modern/modern-19.png" class="token" draggable="false">
                    <img src="./source/modern/modern-20.png" class="token" draggable="false">
                    <img src="./source/modern/modern-21.png" class="token" draggable="false">
                    <img src="./source/modern/modern-22.png" class="token" draggable="false">
                    <img src="./source/modern/modern-23.png" class="token" draggable="false">
                    <img src="./source/modern/modern-24.png" class="token" draggable="false">
                    <img src="./source/modern/modern-25.png" class="token" draggable="false">
                    <img src="./source/modern/modern-26.png" class="token" draggable="false">
                    <img src="./source/modern/modern-27.png" class="token" draggable="false">
                    <img src="./source/modern/modern-28.png" class="token" draggable="false">
                    <img src="./source/modern/modern-29.png" class="token" draggable="false">
                    <img src="./source/modern/modern-30.png" class="token" draggable="false">
                    <img src="./source/modern/modern-31.png" class="token" draggable="false">
                    <img src="./source/modern/modern-32.png" class="token" draggable="false">
                    <img src="./source/modern/modern-33.png" class="token" draggable="false">
                    <img src="./source/modern/modern-34.png" class="token" draggable="false">
                    <img src="./source/modern/modern-35.png" class="token" draggable="false">
                    <img src="./source/modern/modern-36.png" class="token" draggable="false">
                    <img src="./source/modern/modern-37.png" class="token" draggable="false">
                    <img src="./source/modern/modern-38.png" class="token" draggable="false">
                    <img src="./source/modern/modern-39.png" class="token" draggable="false">
                    <img src="./source/modern/modern-40.png" class="token" draggable="false">
                    <img src="./source/modern/modern-41.png" class="token" draggable="false">
                    <img src="./source/modern/modern-42.png" class="token" draggable="false">
                    <img src="./source/modern/modern-43.png" class="token" draggable="false">
                    <img src="./source/modern/modern-44.png" class="token" draggable="false">
                    <img src="./source/modern/modern-45.png" class="token" draggable="false">
                    <img src="./source/modern/modern-46.png" class="token" draggable="false">
                    <img src="./source/modern/modern-47.png" class="token" draggable="false">
                    <img src="./source/modern/modern-48.png" class="token" draggable="false">
                </div>
            </div>
        </div>
        <div class="collapsible-section">
            <button class="collapsible">Monsters ▾</button>
            <div class="content">
                <div class="token-list" id="monsterTokens">
                    <img src="./source/hero-monster/monster-1.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-2.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-3.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-4.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-5.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-6.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-7.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-8.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-9.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-10.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-11.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-12.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-13.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-14.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-15.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-16.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-17.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-18.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-19.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-20.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-21.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-22.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-23.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-24.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-25.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-26.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-27.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-28.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-29.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-30.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-31.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-32.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-33.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-34.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-35.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-36.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-37.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-38.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-39.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-40.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-41.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-42.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-43.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-44.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-45.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-46.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-47.png" class="token" draggable="false">
                    <img src="./source/hero-monster/monster-48.png" class="token" draggable="false">
                </div>
            </div>
        </div>
        <div class="collapsible-section">
            <button class="collapsible">Large Monsters ▾</button>
            <div class="content">
                <div class="token-list" id="largeMonsterTokens">
                    <img src="./source/large-monster/large-monster-1.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-2.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-3.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-4.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-5.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-6.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-7.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-8.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-9.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-10.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-11.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-12.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-13.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-14.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-15.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-16.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-17.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-18.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-19.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-20.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-21.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-22.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-23.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-24.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-25.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-26.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-27.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-28.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-29.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-30.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-31.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-32.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-33.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-34.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-35.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-36.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-37.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-38.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-39.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-40.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-41.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-42.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-43.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-44.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-45.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-46.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-47.png" class="token" draggable="false">
                    <img src="./source/large-monster/large-monster-48.png" class="token" draggable="false">
                </div>
            </div>
        </div>
        <div class="collapsible-section">
            <button class="collapsible">Huge Monsters ▾</button>
            <div class="content">
                <div class="token-list" id="hugeMonsterTokens">
                    <img src="./source/huge-monster/huge-monster-1.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-2.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-3.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-4.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-5.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-6.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-7.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-8.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-9.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-10.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-11.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-12.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-13.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-14.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-15.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-16.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-17.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-18.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-19.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-20.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-21.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-22.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-23.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-24.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-25.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-26.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-27.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-28.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-29.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-30.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-31.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-32.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-33.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-34.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-35.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-36.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-37.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-38.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-39.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-40.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-41.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-42.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-43.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-44.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-45.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-46.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-47.png" class="token" draggable="false">
                    <img src="./source/huge-monster/huge-monster-48.png" class="token" draggable="false">
                </div>
            </div>
        </div>
        <div class="collapsible-section">
            <button class="collapsible">Gargantuan Monsters ▾</button>
            <div class="content">
                <div class="token-list" id="gargantuanMonsterTokens">
                    <img src="./source/gargantuan-monster/gargantuan-monster-1.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-2.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-3.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-4.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-5.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-6.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-7.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-8.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-9.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-10.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-11.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-12.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-13.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-14.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-15.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-16.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-17.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-18.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-19.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-20.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-21.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-22.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-23.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-24.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-25.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-26.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-27.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-28.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-29.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-30.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-31.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-32.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-33.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-34.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-35.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-36.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-37.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-38.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-39.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-40.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-41.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-42.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-43.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-44.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-45.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-46.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-47.png" class="token" draggable="false">
                    <img src="./source/gargantuan-monster/gargantuan-monster-48.png" class="token" draggable="false">
                </div>
            </div>
        </div>
        <div class="collapsible-section">
            <button class="collapsible">Features ▾</button>
            <div class="content">
                <div class="token-list" id="featureTokens">
                    <img src="./source/features/feature-1.png" class="token" draggable="false">
                    <img src="./source/features/feature-2.png" class="token" draggable="false">
                    <img src="./source/features/feature-3.png" class="token" draggable="false">
                    <img src="./source/features/feature-4.png" class="token" draggable="false">
                    <img src="./source/features/feature-5.png" class="token" draggable="false">
                    <img src="./source/features/feature-6.png" class="token" draggable="false">
                    <img src="./source/features/feature-7.png" class="token" draggable="false">
                    <img src="./source/features/feature-8.png" class="token" draggable="false">
                    <img src="./source/features/feature-9.png" class="token" draggable="false">
                    <img src="./source/features/feature-10.png" class="token" draggable="false">
                    <img src="./source/features/feature-11.png" class="token" draggable="false">
                    <img src="./source/features/feature-12.png" class="token" draggable="false">
                    <img src="./source/features/feature-13.png" class="token" draggable="false">
                    <img src="./source/features/feature-14.png" class="token" draggable="false">
                    <img src="./source/features/feature-15.png" class="token" draggable="false">
                    <img src="./source/features/feature-16.png" class="token" draggable="false">
                    <img src="./source/features/feature-17.png" class="token" draggable="false">
                    <img src="./source/features/feature-18.png" class="token" draggable="false">
                    <img src="./source/features/feature-19.png" class="token" draggable="false">
                    <img src="./source/features/feature-20.png" class="token" draggable="false">
                    <img src="./source/features/feature-21.png" class="token" draggable="false">
                    <img src="./source/features/feature-22.png" class="token" draggable="false">
                    <img src="./source/features/feature-23.png" class="token" draggable="false">
                    <img src="./source/features/feature-24.png" class="token" draggable="false">
                    <img src="./source/features/feature-25.png" class="token" draggable="false">
                    <img src="./source/features/feature-26.png" class="token" draggable="false">
                    <img src="./source/features/feature-27.png" class="token" draggable="false">
                    <img src="./source/features/feature-28.png" class="token" draggable="false">
                    <img src="./source/features/feature-29.png" class="token" draggable="false">
                    <img src="./source/features/feature-30.png" class="token" draggable="false">
                    <img src="./source/features/feature-31.png" class="token" draggable="false">
                    <img src="./source/features/feature-32.png" class="token" draggable="false">
                    <img src="./source/features/feature-33.png" class="token" draggable="false">
                    <img src="./source/features/feature-34.png" class="token" draggable="false">
                    <img src="./source/features/feature-35.png" class="token" draggable="false">
                    <img src="./source/features/feature-36.png" class="token" draggable="false">
                    <img src="./source/features/feature-37.png" class="token" draggable="false">
                    <img src="./source/features/feature-38.png" class="token" draggable="false">
                    <img src="./source/features/feature-39.png" class="token" draggable="false">
                    <img src="./source/features/feature-40.png" class="token" draggable="false">
                    <img src="./source/features/feature-41.png" class="token" draggable="false">
                    <img src="./source/features/feature-42.png" class="token" draggable="false">
                    <img src="./source/features/feature-43.png" class="token" draggable="false">
                    <img src="./source/features/feature-44.png" class="token" draggable="false">
                    <img src="./source/features/feature-45.png" class="token" draggable="false">
                    <img src="./source/features/feature-46.png" class="token" draggable="false">
                    <img src="./source/features/feature-47.png" class="token" draggable="false">
                    <img src="./source/features/feature-48.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-1.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-2.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-3.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-4.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-5.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-6.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-7.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-8.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-9.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-10.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-11.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-12.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-13.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-14.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-15.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-16.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-17.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-18.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-19.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-20.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-21.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-22.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-23.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-24.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-25.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-26.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-27.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-28.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-29.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-30.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-31.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-32.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-33.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-34.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-35.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-36.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-37.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-38.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-39.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-40.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-41.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-42.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-43.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-44.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-45.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-46.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-47.png" class="token" draggable="false">
                    <img src="./source/features/modern-feature-48.png" class="token" draggable="false">
                </div>
            </div>
        </div>
        <div class="collapsible-section">
            <button class="collapsible">Large Features ▾</button>
            <div class="content">
                <div class="token-list" id="largeFeatureTokens">
                    <img src="./source/large-feature/large-feature-1.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-2.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-3.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-4.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-5.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-6.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-7.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-8.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-9.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-10.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-11.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-12.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-13.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-14.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-15.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-16.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-17.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-18.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-19.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-20.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-21.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-22.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-23.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-24.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-25.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-26.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-27.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-28.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-29.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-30.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-31.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-32.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-33.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-34.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-35.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-36.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-37.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-38.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-39.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-40.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-41.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-42.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-43.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-44.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-45.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-46.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-47.png" class="token" draggable="false">
                    <img src="./source/large-feature/large-feature-48.png" class="token" draggable="false">
                </div>
            </div>
        </div>
        <div class="collapsible-section">
            <button class="collapsible">Huge Features ▾</button>
            <div class="content">
                <div class="token-list" id="hugeFeatureTokens">
                    <img src="./source/huge-feature/huge-feature-1.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-2.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-3.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-4.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-5.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-6.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-7.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-8.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-9.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-10.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-11.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-12.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-13.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-14.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-15.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-16.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-17.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-18.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-19.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-20.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-21.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-22.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-23.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-24.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-25.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-26.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-27.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-28.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-29.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-30.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-31.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-32.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-33.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-34.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-35.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-36.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-37.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-38.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-39.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-40.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-41.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-42.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-43.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-44.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-45.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-46.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-47.png" class="token" draggable="false">
                    <img src="./source/huge-feature/huge-feature-48.png" class="token" draggable="false">
                </div>
            </div>
        </div>
        <div class="collapsible-section" id="diceRollerSection">
            <button class="collapsible">Dice Roller ▾</button>
            <div class="content">
                <div class="dice-roller" id="diceRoller">
                    <label for="diceCount">Number of Dice:</label>
                    <input type="number" id="diceCount" min="1" value="1" aria-label="Number of dice to roll">
                    <label for="diceModifier">Modifier:</label>
                    <input type="number" id="diceModifier" value="0" aria-label="Dice roll modifier">
                    <label for="diceType">Dice Type:</label>
                    <select id="diceType" aria-label="Select dice type">
                        <option value="4">d4</option>
                        <option value="6">d6</option>
                        <option value="8">d8</option>
                        <option value="10">d10</option>
                        <option value="100">d10%</option>
                        <option value="12">d12</option>
                        <option value="20">d20</option>
                    </select>                    
                    <button id="rollDice">Roll Dice</button>
                    <textarea id="diceResult" readonly aria-label="Dice roll results"></textarea>
                    <audio id="diceSound" preload="auto">
                        <source src="./source/sounds/dice-roll.wav" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                </div>
            </div>
        </div>
    </div>
    <div class="floating-panel" id="floatingPanel">
        <button class="panel-collapsible">Menu ▾</button>
        <div class="panel-content">
            <div class="line-line">
                <div class="button-row-top">
                    <label class="upload-btn">Upload Map<input type="file" id="customMapFloating"
                            accept="image/*"></label>
                    <button id="resetBoardFloating">Reset</button>
                    <button id="toggleFullscreenFloating">Exit Full Screen</button>
                </div>
                <div class="button-row-bottom">
                    <button id="saveBoardFloating">Save</button>
                    <button id="helpButtonFloating">Help </button>
                    <label class="load-btn" id="loadBoardFloating">Load<input type="file" id="loadBoardFloatingInput"
                           accept="application/json">
                    </label>
                </div>
                <!-- <div class="line-line">
                        
                    </div> -->
                
            </div>
        </div>
    </div>
    
    <main>
        <div id="board-container" aria-label="Área do grid, arraste com o mouse ou use as setas para navegar"
            tabindex="0">
            <div class="board" id="board">
                <canvas id="canvas"></canvas>
            </div>
        </div>
    </main>
    <aside class="notes-panel">
        <label for="mapSelect" style="position: absolute; left: -9999px;">Map:</label>
        <select id="mapSelect">
            <option value="./source/images/parchment.jpg">Parchment</option>
            <option value="./source/images/black.jpg">Black Wood</option>

        </select>
        <h3>Notes</h3>
        <textarea id="notes" placeholder="..." spellcheck="false"></textarea>
    </aside>
    <div id="resetModal">
        <div class="modal-content">
            <p>Reset map?</p>
            <div class="modal-buttons">
                <button id="confirmResetYes">Sim</button>
                <button id="confirmResetNo">Não</button>
            </div>
        </div>
    </div>
    <div id="helpModal">
        <div class="modal-content">
            <h3 class="magic-title">Super Grid+ Guide</h3>
            <p>Welcome to the <span class="sparkle">dazzling</span> Super Grid+ <br> Unleash your imagination with these
                <span class="glow">epic</span> features:
            </p>
            <ul>
                <li><strong><span class="gradient">Token Selection</span>:</strong> Click a <span
                        class="sparkle">token</span> (heroes, monsters, etc.) in the side panel to select it. The chosen
                    one glows with a <span class="glow">red border</span>.</li>
                <li><strong><span class="gradient">Token Placement</span>:</strong> Click a map cell to place your <span
                        class="sparkle">token</span>. Hold <kbd>Shift</kbd> to scatter <span class="glow">multiple
                        tokens</span> without deselecting.</li>
                <li><strong><span class="gradient">Token Flipping</span>:</strong> Double-click a <span
                        class="sparkle">token</span> on the map to <span class="glow">flip it horizontally</span> with a
                    magical twist.</li>
                <li><strong><span class="gradient">Token Removal</span>:</strong> Right-click a <span
                        class="sparkle">token</span> on the map to make it <span class="glow">vanish</span>.</li>
                <li><strong><span class="gradient">Map Panel</span>:</strong>
                    <ul>
                        <li><strong><span class="sparkle">Upload Map</span>:</strong> Conjure a <span
                                class="glow">custom image</span> for the map’s mystical background.</li>
                        <li><strong><span class="sparkle">Reset</span>:</strong> Banish all <span
                                class="glow">tokens</span> from the map (confirm in the arcane modal).</li>
                        <li><strong><span class="sparkle">Full Screen</span>:</strong> Dive into <span
                                class="glow">full-screen mode</span>, summoning a floating panel of wonders.</li>
                        <li><strong><span class="sparkle">Save</span>:</strong> Capture the map’s <span
                                class="glow">essence</span> (tokens, music, notes) as a JSON scroll.</li>
                        <li><strong><span class="sparkle">Load</span>:</strong> Resurrect a saved state from a <span
                                class="glow">JSON scroll</span>.</li>
                    </ul>
                </li>
                <li><strong><span class="gradient">Music</span>:</strong> Choose a <span
                        class="sparkle">soundtrack</span> from the dropdown to weave a <span class="glow">looping
                        spell</span> of ambiance.</li>
                <li><strong><span class="gradient">Dice Rolling</span>:</strong> Select the type and number of <span
                        class="sparkle">dice</span>, add a modifier, and cast them with <span class="glow">“Roll
                        Dice”</span>. Results shimmer on the map and in the chronicle.</li>
                <li><strong><span class="gradient">Notes</span>:</strong> Inscribe your <span class="sparkle">session’s
                        lore</span> in the notes panel.</li>
                <li><strong><span class="gradient">Map Navigation</span>:</strong>
                    <ul>
                        <li><strong><span class="sparkle">Pan</span>:</strong> Drag the map with a <span
                                class="glow">mystic touch</span> or use the arrow keys.</li>
                        <li><strong><span class="sparkle">Zoom</span>:</strong> Spin the mouse wheel to <span
                                class="glow">magnify or shrink</span> the realm (0.4x to 2x).</li>
                    </ul>
                </li>
            </ul>
            <div class="modal-buttons">
                <button id="closeHelpModal">Close</button>
            </div>
        </div>
    </div>
    <script>
        const board = document.getElementById("board");
        const canvas = document.getElementById("canvas");
        const boardContainer = document.getElementById("board-container");
        const mapSelect = document.getElementById("mapSelect");
        const musicSelect = document.getElementById("musicSelect");
        const audioPlayer = document.getElementById("audioPlayer");
        const resetButton = document.getElementById("resetBoard");
        const resetButtonFloating = document.getElementById("resetBoardFloating");
        const customMapInput = document.getElementById("customMap");
        const customMapInputFloating = document.getElementById("customMapFloating");
        const toggleFullscreenButton = document.getElementById("toggleFullscreen");
        const toggleFullscreenButtonFloating = document.getElementById("toggleFullscreenFloating");
        const floatingPanel = document.getElementById("floatingPanel");
        const resetModal = document.getElementById("resetModal");
        const confirmResetYes = document.getElementById("confirmResetYes");
        const confirmResetNo = document.getElementById("confirmResetNo");
        const saveBoardButton = document.getElementById("saveBoard");
        const saveBoardButtonFloating = document.getElementById("saveBoardFloating");
        const loadBoardInput = document.getElementById("loadBoardInput");
        const loadBoardInputFloating = document.getElementById("loadBoardFloatingInput");
        const notesTextarea = document.getElementById("notes");
        const diceTypeSelect = document.getElementById("diceType");
        const diceCountInput = document.getElementById("diceCount");
        const diceModifierInput = document.getElementById("diceModifier");
        const rollDiceButton = document.getElementById("rollDice");
        const diceResultTextarea = document.getElementById("diceResult");

        let zoomLevel = 1;
        const minZoom = 0.4;
        const maxZoom = 2;
        const zoomStep = 0.1;
        let selectedToken = null;
        let selectedTokenSrc = null;
        let selectedTokenSize = null;
        const gridSize = 50;
        const cellSize = 5000 / gridSize; // 100px por célula
        const baseWidth = 5000;
        const baseHeight = 5000;
        let isPanning = false;
        let startX, startY, startScrollLeft, startScrollTop;
        let hasMoved = false;
        const moveThreshold = 5;
        let backgroundImage = null;
        let rollHistory = [];

        const ctx = canvas.getContext("2d");
        canvas.width = baseWidth;
        canvas.height = baseHeight;

        function updateBoardSize() {
            const scaledWidth = baseWidth * zoomLevel;
            const scaledHeight = baseHeight * zoomLevel;
            board.style.width = `${scaledWidth}px`;
            board.style.height = `${scaledHeight}px`;
            canvas.style.transform = `scale(${zoomLevel})`;

            document.querySelectorAll(".draggable-token").forEach(token => {
                const baseX = parseFloat(token.dataset.baseLeft);
                const baseY = parseFloat(token.dataset.baseTop);
                const cellWidth = baseWidth / gridSize;
                const tokenSize = token.classList.contains("gargantuan") ? 4 : token.classList.contains("huge") ? 3 : token.classList.contains("large") ? 2 : 1;
                const tokenWidth = cellWidth * tokenSize;
                const isFlipped = token.classList.contains("flipped");
                const adjustedLeft = isFlipped ? baseX * zoomLevel + tokenWidth * zoomLevel : baseX * zoomLevel;
                token.style.left = `${adjustedLeft}px`;
                token.style.top = `${baseY * zoomLevel}px`;
                token.style.transform = isFlipped ? `scaleX(-1) scale(${zoomLevel})` : `scale(${zoomLevel})`;
            });
        }

        function loadMap(imageSrc) {
            const img = new Image();
            img.src = imageSrc;
            img.onload = () => {
                backgroundImage = img;
                drawBoard();
            };
            img.onerror = () => {
                backgroundImage = null;
                drawBoard();
            };
        }

        function drawBoard() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (backgroundImage) {
                ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
            } else {
                ctx.fillStyle = "#1e1e1e";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }

            ctx.strokeStyle = "#000";
            ctx.lineWidth = 0.5;

            const rect = boardContainer.getBoundingClientRect();
            const scrollLeft = boardContainer.scrollLeft / zoomLevel;
            const scrollTop = boardContainer.scrollTop / zoomLevel;
            const visibleWidth = rect.width / zoomLevel;
            const visibleHeight = rect.height / zoomLevel;

            const startCol = Math.max(0, Math.floor(scrollLeft / cellSize));
            const startRow = Math.max(0, Math.floor(scrollTop / cellSize));
            const endCol = Math.min(gridSize, Math.ceil((scrollLeft + visibleWidth) / cellSize));
            const endRow = Math.min(gridSize, Math.ceil((scrollTop + visibleHeight) / cellSize));

            for (let col = startCol; col <= endCol; col++) {
                ctx.beginPath();
                ctx.moveTo(col * cellSize, startRow * cellSize);
                ctx.lineTo(col * cellSize, endRow * cellSize);
                ctx.stroke();
            }
            for (let row = startRow; row <= endRow; row++) {
                ctx.beginPath();
                ctx.moveTo(startCol * cellSize, row * cellSize);
                ctx.lineTo(endCol * cellSize, row * cellSize);
                ctx.stroke();
            }

            const mousePos = getMousePos(lastMouseX, lastMouseY);
            if (mousePos) {
                const col = Math.floor(mousePos.x / cellSize);
                const row = Math.floor(mousePos.y / cellSize);
                if (col >= 0 && col < gridSize && row >= 0 && row < gridSize) {
                    ctx.fillStyle = "rgba(255, 255, 255, 0.2)";
                    ctx.fillRect(col * cellSize, row * cellSize, cellSize, cellSize);
                }
            }
        }

        let lastMouseX = 0, lastMouseY = 0;
        function getMousePos(clientX, clientY) {
            const rect = boardContainer.getBoundingClientRect();
            const x = ((clientX - rect.left) + boardContainer.scrollLeft) / zoomLevel;
            const y = ((clientY - rect.top) + boardContainer.scrollTop) / zoomLevel;
            if (x >= 0 && x < baseWidth && y >= 0 && y < baseHeight) {
                return { x, y };
            }
            return null;
        }

        canvas.addEventListener("mousemove", (e) => {
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
            drawBoard();
        });

        mapSelect.addEventListener("change", (e) => {
            loadMap(e.target.value);
            saveBoardState();
        });

        function handleMapUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    loadMap(e.target.result);
                    mapSelect.value = "";
                    saveBoardState();
                };
                reader.readAsDataURL(file);
            }
        }

        customMapInput.addEventListener("change", handleMapUpload);
        customMapInputFloating.addEventListener("change", handleMapUpload);

        loadMap(mapSelect.value);

        musicSelect.addEventListener("change", () => {
            const source = audioPlayer.querySelector("source");
            source.src = musicSelect.value;
            audioPlayer.load();
            audioPlayer.play();
            saveBoardState();
        });

        function handleReset() {
            resetModal.style.display = "flex";
        }

        function closeModal() {
            resetModal.style.display = "none";
        }

        confirmResetYes.addEventListener("click", () => {
            document.querySelectorAll(".draggable-token").forEach(el => el.remove());
            deselectToken();
            drawBoard();
            saveBoardState();
            closeModal();
        });

        confirmResetNo.addEventListener("click", closeModal);

        resetModal.addEventListener("click", (e) => {
            if (e.target === resetModal) {
                closeModal();
            }
        });

        resetButton.addEventListener("click", handleReset);
        resetButtonFloating.addEventListener("click", handleReset);

        function restrictScroll() {
            const maxScrollLeft = boardContainer.scrollWidth - boardContainer.clientWidth;
            const maxScrollTop = boardContainer.scrollHeight - boardContainer.clientHeight;
            boardContainer.scrollLeft = Math.min(Math.max(boardContainer.scrollLeft, 0), maxScrollLeft);
            boardContainer.scrollTop = Math.min(Math.max(boardContainer.scrollTop, 0), maxScrollTop);
        }

        function updateZoom(newZoom, clientX, clientY) {
            const oldZoom = zoomLevel;
            zoomLevel = Math.min(Math.max(newZoom, minZoom), maxZoom);
            if (oldZoom === zoomLevel) return;

            const rect = boardContainer.getBoundingClientRect();
            const mouseX = ((clientX - rect.left) + boardContainer.scrollLeft) / oldZoom;
            const mouseY = ((clientY - rect.top) + boardContainer.scrollTop) / oldZoom;

            updateBoardSize();

            boardContainer.scrollLeft = mouseX * zoomLevel - (clientX - rect.left);
            boardContainer.scrollTop = mouseY * zoomLevel - (clientY - rect.top);

            restrictScroll();
            drawBoard();
        }

        boardContainer.addEventListener("wheel", (e) => {
            e.preventDefault();
            const delta = e.deltaY > 0 ? -zoomStep : zoomStep;
            updateZoom(zoomLevel + delta, e.clientX, e.clientY);
        });

        boardContainer.addEventListener("mousedown", (e) => {
            if (e.button !== 0) return;
            isPanning = true;
            hasMoved = false;
            boardContainer.classList.add("grabbing");
            startX = e.clientX;
            startY = e.clientY;
            startScrollLeft = boardContainer.scrollLeft;
            startScrollTop = boardContainer.scrollTop;
        });

        boardContainer.addEventListener("mousemove", (e) => {
            if (!isPanning) return;
            e.preventDefault();
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;
            if (Math.abs(dx) > moveThreshold || Math.abs(dy) > moveThreshold) {
                hasMoved = true;
            }
            boardContainer.scrollLeft = startScrollLeft - dx;
            boardContainer.scrollTop = startScrollTop - dy;
            restrictScroll();
            drawBoard();
        });

        boardContainer.addEventListener("mouseup", () => {
            isPanning = false;
            boardContainer.classList.remove("grabbing");
        });

        boardContainer.addEventListener("mouseleave", () => {
            if (isPanning) {
                isPanning = false;
                boardContainer.classList.remove("grabbing");
            }
        });

        boardContainer.addEventListener("keydown", (e) => {
            if (e.key === "ArrowLeft") {
                boardContainer.scrollLeft -= 50;
                e.preventDefault();
            } else if (e.key === "ArrowRight") {
                boardContainer.scrollLeft += 50;
                e.preventDefault();
            } else if (e.key === "ArrowUp") {
                boardContainer.scrollTop -= 50;
                e.preventDefault();
            } else if (e.key === "ArrowDown") {
                boardContainer.scrollTop += 50;
                e.preventDefault();
            }
            restrictScroll();
            drawBoard();
        });

        function deselectToken() {
            if (selectedToken) {
                selectedToken.classList.remove("selected");
                selectedToken = null;
                selectedTokenSrc = null;
                selectedTokenSize = null;
            }
        }

        function isAreaFree(row, col, size, excludeToken = null) {
            const sizeMap = {
                normal: 1,
                large: 2,
                huge: 3,
                gargantuan: 4
            };
            const tokenSize = sizeMap[size] || 1;
            const tokens = document.querySelectorAll(".draggable-token");

            for (let r = row; r < row + tokenSize; r++) {
                for (let c = col; c < col + tokenSize; c++) {
                    if (r >= gridSize || c >= gridSize) {
                        return false;
                    }
                    for (const token of tokens) {
                        if (token === excludeToken) continue;
                        const tokenLeft = parseFloat(token.dataset.baseLeft);
                        const tokenTop = parseFloat(token.dataset.baseTop);
                        const cellWidth = baseWidth / gridSize;
                        const tokenRow = Math.floor(tokenTop / cellWidth);
                        const tokenCol = Math.floor(tokenLeft / cellWidth);
                        let tokenArea = 1;
                        if (token.classList.contains("gargantuan")) tokenArea = 4;
                        else if (token.classList.contains("huge")) tokenArea = 3;
                        else if (token.classList.contains("large")) tokenArea = 2;

                        if (
                            r >= tokenRow &&
                            r < tokenRow + tokenArea &&
                            c >= tokenCol &&
                            c < tokenCol + tokenArea
                        ) {
                            return false;
                        }
                    }
                }
            }
            return true;
        }

        function placeToken(row, col, isShiftHeld) {
            const cellWidth = baseWidth / gridSize;
            const cellHeight = baseHeight / gridSize;
            const baseX = col * cellWidth;
            const baseY = row * cellHeight;

            if (selectedTokenSize === "large" && (row >= gridSize - 1 || col >= gridSize - 1)) {
                return;
            }
            if (selectedTokenSize === "huge" && (row >= gridSize - 2 || col >= gridSize - 2)) {
                return;
            }
            if (selectedTokenSize === "gargantuan" && (row >= gridSize - 3 || col >= gridSize - 3)) {
                return;
            }

            if (selectedTokenSrc) {
                if (!isAreaFree(row, col, selectedTokenSize)) {
                    return;
                }

                const newToken = document.createElement("img");
                newToken.src = selectedTokenSrc;
                newToken.classList.add("draggable-token");
                if (selectedTokenSize === "large") {
                    newToken.classList.add("large");
                    newToken.setAttribute("aria-label", "Large token");
                } else if (selectedTokenSize === "huge") {
                    newToken.classList.add("huge");
                    newToken.setAttribute("aria-label", "Huge token");
                } else if (selectedTokenSize === "gargantuan") {
                    newToken.classList.add("gargantuan");
                    newToken.setAttribute("aria-label", "Gargantuan token");
                } else {
                    newToken.setAttribute("aria-label", "Token");
                }
                newToken.style.position = "absolute";
                newToken.style.left = `${baseX * zoomLevel}px`;
                newToken.style.top = `${baseY * zoomLevel}px`;
                newToken.dataset.baseLeft = baseX;
                newToken.dataset.baseTop = baseY;
                const tokenWidth = cellWidth * (selectedTokenSize === "gargantuan" ? 4 : selectedTokenSize === "huge" ? 3 : selectedTokenSize === "large" ? 2 : 1);
                const tokenHeight = cellHeight * (selectedTokenSize === "gargantuan" ? 4 : selectedTokenSize === "huge" ? 3 : selectedTokenSize === "large" ? 2 : 1);
                newToken.style.width = `${tokenWidth}px`;
                newToken.style.height = `${tokenHeight}px`;
                newToken.style.transform = `scale(${zoomLevel})`;
                newToken.style.zIndex = "10";
                board.appendChild(newToken);
                setupTokenEvents(newToken);
                if (!isShiftHeld) {
                    deselectToken();
                }
                saveBoardState();
            } else if (selectedToken && selectedToken.classList.contains("draggable-token")) {
                let tokenSize = "normal";
                if (selectedToken.classList.contains("gargantuan")) tokenSize = "gargantuan";
                else if (selectedToken.classList.contains("huge")) tokenSize = "huge";
                else if (selectedToken.classList.contains("large")) tokenSize = "large";

                if (tokenSize === "large" && (row >= gridSize - 1 || col >= gridSize - 1)) {
                    return;
                }
                if (tokenSize === "huge" && (row >= gridSize - 2 || col >= gridSize - 2)) {
                    return;
                }
                if (tokenSize === "gargantuan" && (row >= gridSize - 3 || col >= gridSize - 3)) {
                    return;
                }

                if (!isAreaFree(row, col, tokenSize, selectedToken)) {
                    return;
                }

                const tokenSizeNum = tokenSize === "gargantuan" ? 4 : tokenSize === "huge" ? 3 : tokenSize === "large" ? 2 : 1;
                const tokenWidth = cellWidth * tokenSizeNum;
                const isFlipped = selectedToken.classList.contains("flipped");
                const adjustedLeft = isFlipped ? baseX * zoomLevel + tokenWidth * zoomLevel : baseX * zoomLevel;
                selectedToken.style.left = `${adjustedLeft}px`;
                selectedToken.style.top = `${baseY * zoomLevel}px`;
                selectedToken.dataset.baseLeft = baseX;
                selectedToken.dataset.baseTop = baseY;
                selectedToken.style.transform = isFlipped ? `scaleX(-1) scale(${zoomLevel})` : `scale(${zoomLevel})`;
                if (!isShiftHeld) {
                    deselectToken();
                }
                saveBoardState();
            }
        }

        function setupTokenEvents(token) {
            token.addEventListener("click", (e) => {
                e.stopPropagation();
                if (selectedToken === token) {
                    deselectToken();
                } else {
                    deselectToken();
                    selectedToken = token;
                    selectedToken.classList.add("selected");
                }
            });

            token.addEventListener("contextmenu", (e) => {
                e.preventDefault();
                if (selectedToken === token) {
                    deselectToken();
                }
                token.remove();
                saveBoardState();
            });

            token.addEventListener("dblclick", (e) => {
                e.stopPropagation();
                token.classList.toggle("flipped");
                const cellWidth = baseWidth / gridSize;
                const baseX = parseFloat(token.dataset.baseLeft);
                const tokenSize = token.classList.contains("gargantuan") ? 4 : token.classList.contains("huge") ? 3 : token.classList.contains("large") ? 2 : 1;
                const tokenWidth = cellWidth * tokenSize;
                const isFlipped = token.classList.contains("flipped");
                const adjustedLeft = isFlipped ? baseX * zoomLevel + tokenWidth * zoomLevel : baseX * zoomLevel;
                token.style.left = `${adjustedLeft}px`;
                token.style.transform = isFlipped ? `scaleX(-1) scale(${zoomLevel})` : `scale(${zoomLevel})`;
                saveBoardState();
            });
        }

        document.querySelectorAll(".token").forEach((token) => {
            token.addEventListener("click", (e) => {
                e.stopPropagation();
                if (selectedToken === token) {
                    deselectToken();
                } else {
                    deselectToken();
                    selectedToken = token;
                    selectedTokenSrc = token.src;
                    if (token.closest("#gargantuanMonsterTokens")) {
                        selectedTokenSize = "gargantuan";
                    } else if (token.closest("#hugeMonsterTokens") || token.closest("#hugeFeatureTokens")) {
                        selectedTokenSize = "huge";
                    } else if (token.closest("#largeMonsterTokens") || token.closest("#largeFeatureTokens")) {
                        selectedTokenSize = "large";
                    } else {
                        selectedTokenSize = "normal";
                    }
                    selectedToken.classList.add("selected");
                }
            });
        });

        canvas.addEventListener("click", (e) => {
            e.stopPropagation();
            if (hasMoved) {
                return;
            }
            if (selectedToken) {
                const mousePos = getMousePos(e.clientX, e.clientY);
                if (mousePos) {
                    const cellWidth = baseWidth / gridSize;
                    const cellHeight = baseHeight / gridSize;
                    const col = Math.floor(mousePos.x / cellWidth);
                    const row = Math.floor(mousePos.y / cellHeight);

                    if (row >= 0 && row < gridSize && col >= 0 && col < gridSize) {
                        placeToken(row, col, e.shiftKey);
                    }
                }
            }
        });

        document.querySelectorAll(".collapsible").forEach(button => {
            button.addEventListener("click", () => {
                button.classList.toggle("active");
                const content = button.nextElementSibling;
                if (content.style.maxHeight) {
                    content.style.maxHeight = null;
                } else {
                    content.style.maxHeight = content.scrollHeight + "px";
                }
            });
        });

        const panelCollapsible = document.querySelector(".panel-collapsible");
        panelCollapsible.addEventListener("click", (e) => {
            if (e.target === panelCollapsible) {
                const panelContent = panelCollapsible.nextElementSibling;
                if (floatingPanel.classList.contains("collapsed")) {
                    floatingPanel.classList.remove("collapsed");
                    panelCollapsible.classList.remove("collapsed");
                    panelContent.style.maxHeight = panelContent.scrollHeight + "px";
                } else {
                    floatingPanel.classList.add("collapsed");
                    panelCollapsible.classList.add("collapsed");
                    panelContent.style.maxHeight = null;
                }
            }
        });

        let isDragging = false;
        let dragStartX, dragStartY, panelStartX, panelStartY;

        panelCollapsible.addEventListener("mousedown", (e) => {
            if (!document.fullscreenElement) return;
            if (e.button !== 0) return;
            isDragging = true;
            floatingPanel.classList.add("dragging");
            dragStartX = e.clientX;
            dragStartY = e.clientY;
            const rect = floatingPanel.getBoundingClientRect();
            panelStartX = rect.left;
            panelStartY = rect.top;
        });

        document.addEventListener("mousemove", (e) => {
            if (!isDragging) return;
            const dx = e.clientX - dragStartX;
            const dy = e.clientY - dragStartY;
            let newLeft = panelStartX + dx;
            let newTop = panelStartY + dy;
            const panelWidth = floatingPanel.offsetWidth;
            const panelHeight = floatingPanel.offsetHeight;
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            newLeft = Math.max(0, Math.min(newLeft, viewportWidth - panelWidth));
            newTop = Math.max(0, Math.min(newTop, viewportHeight - panelHeight));
            floatingPanel.style.left = `${newLeft}px`;
            floatingPanel.style.top = `${newTop}px`;
        });

        document.addEventListener("mouseup", () => {
            if (isDragging) {
                isDragging = false;
                floatingPanel.classList.remove("dragging");
            }
        });

        rollDiceButton.addEventListener("click", () => {
            const diceType = parseInt(diceTypeSelect.value);
            const diceCount = parseInt(diceCountInput.value) || 1;
            const modifier = parseInt(diceModifierInput.value) || 0;
            const diceSound = document.getElementById("diceSound");

            if (diceCount < 1) {
                diceResultTextarea.value = "Please enter a valid number of dice (1 or more).";
                return;
            }

            diceSound.currentTime = 0;
            diceSound.play().catch(error => {
                console.error("Erro ao tocar o som dos dados:", error);
            });

            const results = [];
            let total = 0;

            if (diceType === 100) {
                for (let i = 0; i < diceCount; i++) {
                    const tens = Math.floor(Math.random() * 10);
                    const units = Math.floor(Math.random() * 10);
                    const roll = (tens * 10) + units;
                    const finalRoll = roll === 0 ? 100 : roll;
                    results.push(finalRoll);
                    total += finalRoll;
                }
            } else {
                for (let i = 0; i < diceCount; i++) {
                    const roll = Math.floor(Math.random() * diceType) + 1;
                    results.push(roll);
                    total += roll;
                }
            }

            total += modifier;

            results.forEach((result, index) => {
                const diceElement = document.createElement("div");
                diceElement.classList.add("dice-animation");
                diceElement.textContent = result;
                diceElement.setAttribute("aria-label", `Dice roll result: ${result}`);
                boardContainer.appendChild(diceElement);

                const offsetX = (index - (diceCount - 1) / 2) * 60;
                diceElement.style.left = `calc(50% + ${offsetX}px)`;
                diceElement.style.top = "50%";

                setTimeout(() => {
                    diceElement.remove();
                }, 3000);
            });

            const diceLabel = diceType === 100 ? "d10%" : `d${diceType}`;
            const modifierText = modifier !== 0 ? (modifier > 0 ? ` +${modifier}` : ` ${modifier}`) : "";
            const resultText = `Rolled ${diceCount}${diceLabel}${modifierText}: ${results.join(", ")} (Total: ${total})`;

            rollHistory.unshift(resultText);
            if (rollHistory.length > 5) {
                rollHistory.pop();
            }
            diceResultTextarea.value = rollHistory.join("\n");
            saveBoardState();
        });

        function toggleFullscreen() {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().then(() => {
            document.body.classList.add("fullscreen");
            toggleFullscreenButton.textContent = "Exit Full Screen";
            toggleFullscreenButtonFloating.textContent = "Exit Full Screen";
            const collapsibleSections = document.querySelectorAll(".collapsible-section");
            const panelContent = floatingPanel.querySelector(".panel-content");
            collapsibleSections.forEach(section => {
                panelContent.appendChild(section);
            });
            if (floatingPanel.classList.contains("collapsed")) {
                panelCollapsible.click();
            }
            floatingPanel.style.left = "10px";
            floatingPanel.style.top = "10px";
        });
    } else {
        document.exitFullscreen().then(() => {
            document.body.classList.remove("fullscreen");
            toggleFullscreenButton.textContent = "Full Screen";
            toggleFullscreenButtonFloating.textContent = "Full Screen";
            const sidePanel = document.querySelector(".side-panel");
            const collapsibleSections = document.querySelectorAll(".collapsible-section");
            collapsibleSections.forEach(section => {
                sidePanel.appendChild(section);
            });
            floatingPanel.style.left = "10px";
            floatingPanel.style.top = "10px";
        });
    }
}

        toggleFullscreenButton.addEventListener("click", toggleFullscreen);
        toggleFullscreenButtonFloating.addEventListener("click", toggleFullscreen);

        document.addEventListener("fullscreenchange", () => {
            if (!document.fullscreenElement) {
                document.body.classList.remove("fullscreen");
                toggleFullscreenButton.textContent = "Full Screen";
                toggleFullscreenButtonFloating.textContent = "Full Screen";
                const sidePanel = document.querySelector(".side-panel");
                const collapsibleSections = document.querySelectorAll(".collapsible-section");
                collapsibleSections.forEach(section => {
                    sidePanel.appendChild(section);
                });
                floatingPanel.style.left = "10px";
                floatingPanel.style.top = "10px";
            }
        });

        function saveBoardState() {
            const tokens = Array.from(document.querySelectorAll(".draggable-token")).map(token => ({
                src: token.src,
                baseLeft: token.dataset.baseLeft,
                baseTop: token.dataset.baseTop,
                size: token.classList.contains("gargantuan") ? "gargantuan" : token.classList.contains("huge") ? "huge" : token.classList.contains("large") ? "large" : "normal",
                flipped: token.classList.contains("flipped")
            }));
            const state = {
                tokens,
                selectedMap: mapSelect.value,
                selectedMusic: musicSelect.value,
                notes: notesTextarea.value,
                rollHistory
            };
            localStorage.setItem("boardState", JSON.stringify(state));
        }

        function loadBoardState() {
            const state = JSON.parse(localStorage.getItem("boardState"));
            if (!state) return;

            document.querySelectorAll(".draggable-token").forEach(el => el.remove());
            state.tokens.forEach(tokenData => {
                const newToken = document.createElement("img");
                newToken.src = tokenData.src;
                newToken.classList.add("draggable-token");
                if (tokenData.size === "large") newToken.classList.add("large");
                else if (tokenData.size === "huge") newToken.classList.add("huge");
                else if (tokenData.size === "gargantuan") newToken.classList.add("gargantuan");
                if (tokenData.flipped) newToken.classList.add("flipped");
                newToken.style.position = "absolute";
                const cellWidth = baseWidth / gridSize;
                const tokenSize = tokenData.size === "gargantuan" ? 4 : tokenData.size === "huge" ? 3 : tokenData.size === "large" ? 2 : 1;
                const tokenWidth = cellWidth * tokenSize;
                const adjustedLeft = tokenData.flipped ? parseFloat(tokenData.baseLeft) * zoomLevel + tokenWidth * zoomLevel : parseFloat(tokenData.baseLeft) * zoomLevel;
                newToken.style.left = `${adjustedLeft}px`;
                newToken.style.top = `${parseFloat(tokenData.baseTop) * zoomLevel}px`;
                newToken.dataset.baseLeft = tokenData.baseLeft;
                newToken.dataset.baseTop = tokenData.baseTop;
                newToken.style.width = `${tokenWidth}px`;
                newToken.style.height = `${tokenWidth}px`;
                newToken.style.transform = tokenData.flipped ? `scaleX(-1) scale(${zoomLevel})` : `scale(${zoomLevel})`;
                newToken.style.zIndex = "10";
                board.appendChild(newToken);
                setupTokenEvents(newToken);
            });

            if (state.selectedMap) {
                mapSelect.value = state.selectedMap;
                loadMap(state.selectedMap);
            }

            if (state.selectedMusic) {
                musicSelect.value = state.selectedMusic;
                const source = audioPlayer.querySelector("source");
                source.src = state.selectedMusic;
                audioPlayer.load();
                audioPlayer.play();
            }

            if (state.notes) {
                notesTextarea.value = state.notes;
            }

            if (state.rollHistory) {
                rollHistory = state.rollHistory;
                diceResultTextarea.value = rollHistory.join("\n");
            }
        }

        function exportBoardState() {
            const tokens = Array.from(document.querySelectorAll(".draggable-token")).map(token => ({
                src: token.src,
                baseLeft: token.dataset.baseLeft,
                baseTop: token.dataset.baseTop,
                size: token.classList.contains("gargantuan") ? "gargantuan" : token.classList.contains("huge") ? "huge" : token.classList.contains("large") ? "large" : "normal",
                flipped: token.classList.contains("flipped")
            }));
            const state = {
                tokens,
                selectedMap: mapSelect.value,
                notes: notesTextarea.value,
                rollHistory
            };
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state));
            const downloadAnchorNode = document.createElement("a");
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "board-state.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function importBoardState(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const state = JSON.parse(e.target.result);

                    document.querySelectorAll(".draggable-token").forEach(el => el.remove());

                    state.tokens.forEach(tokenData => {
                        const newToken = document.createElement("img");
                        newToken.src = tokenData.src;
                        newToken.classList.add("draggable-token");
                        if (tokenData.size === "large") newToken.classList.add("large");
                        else if (tokenData.size === "huge") newToken.classList.add("huge");
                        else if (tokenData.size === "gargantuan") newToken.classList.add("gargantuan");
                        if (tokenData.flipped) newToken.classList.add("flipped");
                        newToken.style.position = "absolute";
                        const cellWidth = baseWidth / gridSize;
                        const tokenSize = tokenData.size === "gargantuan" ? 4 : tokenData.size === "huge" ? 3 : tokenData.size === "large" ? 2 : 1;
                        const tokenWidth = cellWidth * tokenSize;
                        const adjustedLeft = tokenData.flipped ? parseFloat(tokenData.baseLeft) * zoomLevel + tokenWidth * zoomLevel : parseFloat(tokenData.baseLeft) * zoomLevel;
                        newToken.style.left = `${adjustedLeft}px`;
                        newToken.style.top = `${parseFloat(tokenData.baseTop) * zoomLevel}px`;
                        newToken.dataset.baseLeft = tokenData.baseLeft;
                        newToken.dataset.baseTop = tokenData.baseTop;
                        newToken.style.width = `${tokenWidth}px`;
                        newToken.style.height = `${tokenWidth}px`;
                        newToken.style.transform = tokenData.flipped ? `scaleX(-1) scale(${zoomLevel})` : `scale(${zoomLevel})`;
                        newToken.style.zIndex = "10";
                        board.appendChild(newToken);
                        setupTokenEvents(newToken);
                    });

                    if (state.selectedMap) {
                        mapSelect.value = state.selectedMap;
                        loadMap(state.selectedMap);
                    }

                    if (state.notes) {
                        notesTextarea.value = state.notes;
                    }

                    if (state.rollHistory) {
                        rollHistory = state.rollHistory;
                        diceResultTextarea.value = state.rollHistory.join("\n");
                    }

                    saveBoardState();
                } catch (error) {
                    alert("Erro ao carregar o arquivo: " + error.message);
                }
            };
            reader.readAsText(file);
        }

        saveBoardButton.addEventListener("click", exportBoardState);
        saveBoardButtonFloating.addEventListener("click", exportBoardState);
        loadBoardInput.addEventListener("change", importBoardState);
        loadBoardInputFloating.addEventListener("change", importBoardState);

        loadBoardState();

        // Elementos do modal de ajuda
        const helpButton = document.getElementById("helpButton");
        const helpButtonFloating = document.getElementById("helpButtonFloating");
        const helpModal = document.getElementById("helpModal");
        const closeHelpModal = document.getElementById("closeHelpModal");

        function openHelpModal() {
            helpModal.style.display = "flex";
            const modalContent = helpModal.querySelector(".modal-content");
            modalContent.style.transform = "scale(0.7)";
            modalContent.style.opacity = "0";
            setTimeout(() => {
                modalContent.style.transition = "transform 0.3s ease, opacity 0.3s ease";
                modalContent.style.transform = "scale(1)";
                modalContent.style.opacity = "1";
            }, 10);
        }

        // Função para fechar o modal de ajuda
        function closeHelpModalFn() {
            const modalContent = helpModal.querySelector(".modal-content");
            modalContent.style.transform = "scale(0.7)";
            modalContent.style.opacity = "0";
            setTimeout(() => {
                helpModal.style.display = "none";
                modalContent.style.transition = "";
                modalContent.style.transform = "";
                modalContent.style.opacity = "";
            }, 300);
        }
        // Event listeners
        helpButton.addEventListener("click", openHelpModal);
        helpButtonFloating.addEventListener("click", openHelpModal);
        closeHelpModal.addEventListener("click", closeHelpModalFn);

        // Fechar o modal ao clicar fora do conteúdo
        helpModal.addEventListener("click", (e) => {
            if (e.target === helpModal) {
                closeHelpModalFn();
            }
        });
    </script>
</body>

</html>